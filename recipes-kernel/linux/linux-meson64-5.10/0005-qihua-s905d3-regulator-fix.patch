From a88622fef87e3b3749217ee86e960ee44a9d7663 Mon Sep 17 00:00:00 2001
From: changzhijie <elecboy@126.com>
Date: Wed, 28 Jul 2021 21:55:11 +0800
Subject: [PATCH 05/10] qihua s905d3 regulator fix

---
 .../boot/dts/amlogic/meson-qihua-s905d3.dtsi  | 38 +++++++------------
 .../dts/amlogic/meson-sm1-sports-cle-v4.dts   | 11 +++++-
 2 files changed, 24 insertions(+), 25 deletions(-)

diff --git a/arch/arm64/boot/dts/amlogic/meson-qihua-s905d3.dtsi b/arch/arm64/boot/dts/amlogic/meson-qihua-s905d3.dtsi
index aad67afd162b..7599c252e5e4 100644
--- a/arch/arm64/boot/dts/amlogic/meson-qihua-s905d3.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-qihua-s905d3.dtsi
@@ -79,23 +79,22 @@ vcc_5v: regulator-vcc_5v {
 		regulator-always-on;
 	};
 
-	vcc_1v8: regulator-vcc_1v8 {
+	vcc_3v3: regulator-vcc_3v3 {
 		compatible = "regulator-fixed";
-		regulator-name = "VCC_1V8";
-		regulator-min-microvolt = <1800000>;
-		regulator-max-microvolt = <1800000>;
-		vin-supply = <&vcc_3v3>;
+		regulator-name = "VCC_3V3";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		vin-supply = <&dc_in>;
 		regulator-always-on;
 	};
 
-	vcc_3v3: regulator-vcc_3v3 {
+	vsys_3v3: regulator-vsys_3v3 {
 		compatible = "regulator-fixed";
-		regulator-name = "VCC_3V3";
+		regulator-name = "VSYS_3V3";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
-		vin-supply = <&vsys_3v3>;
+		vin-supply = <&dc_in>;
 		regulator-always-on;
-		/* FIXME: actually controlled by VDDCPU_B_EN */
 	};
 
 	vddao_1v8: regulator-vddao_1v8 {
@@ -112,16 +111,7 @@ emmc_1v8: regulator-emmc_1v8 {
 		regulator-name = "EMMC_AO1V8";
 		regulator-min-microvolt = <1800000>;
 		regulator-max-microvolt = <1800000>;
-		vin-supply = <&vcc_3v3>;
-		regulator-always-on;
-	};
-
-	vsys_3v3: regulator-vsys_3v3 {
-		compatible = "regulator-fixed";
-		regulator-name = "VSYS_3V3";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		vin-supply = <&dc_in>;
+		vin-supply = <&vsys_3v3>;
 		regulator-always-on;
 	};
 
@@ -345,8 +335,8 @@ &sd_emmc_a {
 
 	mmc-pwrseq = <&sdio_pwrseq>;
 
-	vmmc-supply = <&vsys_3v3>;
-	vqmmc-supply = <&vsys_3v3>;
+	vmmc-supply = <&vcc_3v3>;
+	vqmmc-supply = <&vcc_3v3>;
 
 	brcmf: wifi@1 {
 		reg = <1>;
@@ -367,8 +357,8 @@ &sd_emmc_b {
 	disable-wp;
 
 	cd-gpios = <&gpio GPIOC_6 GPIO_ACTIVE_LOW>;
-	vmmc-supply = <&vsys_3v3>;
-	vqmmc-supply = <&vsys_3v3>;
+	vmmc-supply = <&vcc_3v3>;
+	vqmmc-supply = <&vcc_3v3>;
 };
 
 /* eMMC */
@@ -386,7 +376,7 @@ &sd_emmc_c {
 	disable-wp;
 
 	mmc-pwrseq = <&emmc_pwrseq>;
-	vmmc-supply = <&vcc_3v3>;
+	vmmc-supply = <&vsys_3v3>;
 	vqmmc-supply = <&emmc_1v8>;
 };
 
diff --git a/arch/arm64/boot/dts/amlogic/meson-sm1-sports-cle-v4.dts b/arch/arm64/boot/dts/amlogic/meson-sm1-sports-cle-v4.dts
index 7ed991c5751d..2ba93a56962a 100644
--- a/arch/arm64/boot/dts/amlogic/meson-sm1-sports-cle-v4.dts
+++ b/arch/arm64/boot/dts/amlogic/meson-sm1-sports-cle-v4.dts
@@ -71,6 +71,16 @@ led-ble {
 			linux,default-trigger = "default-on";
 		};
 	};
+
+	// gpio-restart {
+	// 	compatible = "gpio-restart";
+	// 	gpios = <&gpio GPIOA_3 GPIO_ACTIVE_HIGH>;
+	// 	priority = <128>;
+	// 	active-delay = <450>;
+	// 	inactive-delay = <100>;
+	// 	wait-delay = <3000>;
+	// 	line-name = "lte-reset";
+	// };
 };
 
 &cpu0 {
@@ -112,7 +122,6 @@ &pwm_AO_cd {
 &sd_emmc_a {
 	/* sd-uhs-sdr50; */
 	max-frequency = <50000000>;
-	vqmmc-supply = <&vsys_3v3>;
 };
 
 &ethmac {
-- 
2.25.1

